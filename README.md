# Пројекат из Напредних техника програмирања

## Опис проблема
Неопходно је имплементирати систем који ће омогућавати пчеларима и љубитељима медних производа да рекламирају своја добра, претражују и коментаришу туђа и обавештавају остале кориснике о догађајима на којима ће презентовати своје медне производе.

## Архитектура система
Архитектура система базирана је на микросервисима. Сваки микросервис поседује засебну базу података (конкретно PostgreSQL) у којој чува податке којима само он управља. Сва комуникација између клијента и сервиса одвија се преко REST API-а. Микросервис за аутентификацију (Users Microservice) дефинише SECRET KEY који остали микросервиси користе за декодовање JWT токена и добављање података о пријављеном кориснику.

## Преглед микросервиса

###### Users Microservice
Django REST апликација која омогућава пријаву, регистрацију (уз верификацију email-а), измену профила корисника и коришћење уграђене Django Admin апликације за администрацију корисника (креирање, брисање, измена и преглед). Сервис приликом пријаве генерише JWT токен који ће корисник користити за аутентификацију на свим сервисима и дефинише SECRET KEY који ће остали сервиси користити за декодовање JWT tokena.

###### Advertisements Microservice
Golang REST апликација која омогућава аутентификованим корисницима креирање, брисање, измену, преглед, пагинацију и претрагу реклама медних производа. **Подаци којима је описана реклама су:** датум објаве, име производа који се рекламира, категорија производа, цена производа, опис производа и скуп слика.

###### Events Microservice
Golang REST апликација која омогућава аутентификованим корисницима креирање, брисање, измену, преглед и пагинацију догађаја на којима се презентује одређени медни производ. **Подаци којима је описан догађај је:** датум објаве, име догађаја, категорија догађаја (сајам, манифестација...), период и место одржавања, опис и скуп слика.

###### Comments Microservice
Django REST апликација која омогућава аутентификованим корисницима коментарисање рекламираних производа, брисање, преглед и пагинацију коментара и подкоментара, like и dislike.

## Клијенти система

###### Angular клијент
Главни клијент имплементиран у Angular језику који омогућава коришћење главних функционалности система. **Локација клијента је localhost:4200.**

###### Pharo клијент
Клијент који омогућава увид у аналитику система. Када администратор унутар Pharo окружења регистријe класу са методом која се налази путањи pharo-client/graphics.txt, добија могућност слања порука окружењу које ће му омогућавати графички приказ броја реклама, догађаја, коментара, like-ова и dislike-ова у одређеном временском интервалу. **Формат порука је CLASS_NAME entity ENTITY start START end END shape SHAPE**, где су елементи редом:
- CLASS_NAME представља назив под којим је администратор регистровао класу која ће имплементирати методу за графичке приказе.
- ENTITY представља ентитет чији се графички приказ жели увидети. Валидне вредности су "ads", "events", "comments", "likes" и "dislikes".
- START представља почетну годину од које се анализира статистика одабраног ентитета. Година мора бити четвороцифрен број.
- END представља крајњу годину до које се анализира статистика одабраног ентитета. Година мора бити четвороцифрен број, мора бити већа од почетне године и не сме бити већа од текуће године.
- SHAPE омогућава кориснику одабир приказа у виду plot-а (уколико се унесе "dots") и bar-ова (уколико се унесе "bars").

###### Django Admin апликација
Users Mikroservice омогућава коришћење уграђене Django Admin апликације која омогућава администрацију корисника - креирање, брисање, измена и преглед. **Локација клијента је localhost:8000/admin.** Да би се апликација могла користити, неопходно је регистровати Django супер корисника, користећи команду **python manage.py createsuperuser.**

## Упутство за покретање
1. Локално креирати Postgre базе са називима **"users", "ads", "events" и "comments".**
2. Користећи команду **python -m venv venv** креирати виртуелно окружење.
3. У виртуелно окружење инсталирати све библиотеке наведене у **requirements.txt** фајлу.
4. Активирати виртуелно окружење, позиционирати се у **user_service** и покренути команде **python manage.py migrate** и **python manage.py runserver.**
5. Активирати виртуелно окружење, позиционирати се у **comment_service** и покренути команде **python manage.py migrate** и **python manage.py runserver 8003.**
6. Покренути команде за преузимање неопходних Golang библиотека:
    - go get -u -v github.com/dgrijalva/jwt-go
    - go get -u -v github.com/gorilla/mux
    - go get -u -v github.com/jinzhu/gorm
    - go get -u -v github.com/lib/pq
    - go get -u -v github.com/rs/cors
7. Позиционирати се у **ad_service** и покренути команду **go run .**
8. Позиционирати се у **event_service** и покренути команду **go run .**
9. Позиционирати се у **angular-client** и покренути команде **npm install** и **ng serve.**
10. Унутар Pharo окружења инсталирати библиотеке **Roassal2** и **NeoJSON.**
11. Унутар Pharo окружења регистровати/креирати класу у произвољном пакету са произвољним називом и унутар **Class опсега** новокреиране класе регистровати методу која се налази на путањи **pharo-client/graphics.txt.**
12. За коришћење Angular клијента у URL претраживача унети путању **localhost:4200.**
13. За коришћење Pharo клијента отворити **Playground Pharo окружења** и слати претходно описане поруке.
14. За коришћење Django Admin апликације у URL претраживача унети путању **localhost:8000/admin.**

## Покретање тестова

###### Покретање јединичних тестова микросервиса написаних у Python-у
Активирати виртулено окружење, позиционирати се у директоријум микросервиса и покренути команду **python manage.py test.**

###### Покретање јединичних тестова микросервиса написаних у Golang-у
Позиционирати се у директоријум микросервиса и покренути команду **go test -v.**
